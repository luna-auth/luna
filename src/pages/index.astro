---
import { actions } from 'astro:actions';
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';

const user = Astro.locals.user;

const result = Astro.getActionResult(actions.auth.logout);
if (result?.data?.success) {
  // Logout successful, refresh the page
  return Astro.redirect('/');
}
---

<Layout title="Home">
  <Navbar />

  {
    user ? (
      <>
        <h1>Welcome, {user.email}!</h1>
        <p>Your session ID is: {Astro.locals.session.id}</p>

        <form method="POST" action={actions.auth.logout}>
          <button type="submit">Logout</button>
        </form>
      </>
    ) : (
      <>
        <h1>Welcome to our site!</h1>
        <p>You are not logged in.</p>
        <p>
          <a href="/login">Login</a> or <a href="/register">Register</a>
        </p>
      </>
    )
  }

  <Footer />
</Layout>
