---
import Layout from '../layouts/Layout.astro';
import RegisterForm from '../components/RegisterForm.astro';
import LoginForm from '../components/LoginForm.astro';
import { actions } from 'astro:actions';

const registerResult = Astro.getActionResult(actions.register);
if (registerResult && !registerResult.error) {
  return Astro.redirect('/');
}

const loginResult = Astro.getActionResult(actions.login);
if (loginResult && !loginResult.error) {
  return Astro.redirect('/');
}

const logoutResult = Astro.getActionResult(actions.logout);
if (logoutResult && !logoutResult.error) {
  return Astro.redirect('/');
}
---

<Layout>
  {
    Astro.locals.user ? (
      <>
        <div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
          <h2>Debug Panel - Zalogowany uÅ¼ytkownik ðŸš€</h2>
          <pre style="background: #fff; padding: 10px; border-radius: 4px;">
            User: {JSON.stringify(Astro.locals.user, null, 2)}
            Session: {JSON.stringify(Astro.locals.session, null, 2)}
          </pre>
        </div>

        <form method="POST" action={actions.logout}>
          <button type="submit">Logout</button>
        </form>
      </>
    ) : (
      <>
        <div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
          <h2>Debug Panel - Niezalogowany ðŸ˜´</h2>
          <p>Kurwa, nikt nie jest zalogowany!</p>
        </div>

        <h2>Register</h2>
        <RegisterForm />
        <h2>Login</h2>
        <LoginForm />
      </>
    )
  }
</Layout>

<style>
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  button {
    background: #ff4444;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
  }

  button:hover {
    background: #ff0000;
  }
</style>
