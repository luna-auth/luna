---
import { actions } from 'astro:actions';
import { isInputError } from 'astro:actions';
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';

if (Astro.locals.user) {
  return Astro.redirect('/');
}

const result = Astro.getActionResult(actions.auth.login);
if (result?.data?.success) {
  // Login successful, redirect to homepage
  return Astro.redirect('/');
}
---

<Layout title="Login">
  <Navbar />

  {
    result?.error && (
      <div class="error">
        {isInputError(result.error)
          ? Object.values(result.error.fields).join(', ')
          : result.error.message}
      </div>
    )
  }

  <form method="POST" action={actions.auth.login}>
    <!-- Email -->
    <label for="email">Email</label>
    <input type="email" id="email" name="email" required />

    <!-- Password -->
    <label for="password">Password</label>
    <input type="password" id="password" name="password" required />

    <button type="submit">Login</button>
  </form>

  <Footer />
</Layout>
