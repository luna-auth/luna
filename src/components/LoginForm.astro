---
import { actions, isInputError } from 'astro:actions';

// Retrieve the result from the server action (auth.login).
const loginResult = Astro.getActionResult(actions.auth.login);

let errorMessage = '';
if (loginResult?.error) {
  if (loginResult.error.code === 'TOO_MANY_REQUESTS') {
    errorMessage = 'Too many login attempts. Please try again later.';
  } else if (loginResult.error.code === 'UNAUTHORIZED') {
    errorMessage = 'Invalid email or password.';
  } else if (isInputError(loginResult.error)) {
    errorMessage = 'Please check your email and password.';
  } else {
    // Fallback dla innych błędów
    errorMessage = loginResult.error.message || 'Login failed. Please try again.';
  }
}

// Success message (zostawiamy, bo to zajebista funkcjonalność!)
let successMessage = '';
if (loginResult?.data?.success) {
  successMessage = 'Login successful!';
}
---
<form 
  method="POST" 
  action={actions.auth.login}
  data-astro-reload
>
  {successMessage && (
    <p style="background: #dfd; padding: 0.5rem; color: green;">
      {successMessage}
    </p>
  )}
  {errorMessage && (
    <p style="background: #fdd; padding: 0.5rem; color: red;">
      {errorMessage}
    </p>
  )}

  <label for="email">Email</label>
  <input
    required
    type="email"
    name="email"
    id="email"
    placeholder="user@example.com"
  />

  <label for="password">Password</label>
  <input
    required
    type="password"
    name="password"
    id="password"
    placeholder="••••••••"
  />

  <button type="submit">Login</button>
</form>